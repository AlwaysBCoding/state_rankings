// Generated by CoffeeScript 1.3.3

$(function() {
  var updateRankingClasses;
  $(".sortable").sortable({
    items: ".state",
    update: function(event, ui) {
      var sortables, sortorder;
      sortables = ui.item.parent().find(".state");
      sortorder = [];
      _.each(sortables, function(item) {
        return sortorder.push($(item).attr("data-id"));
      });
      return $.ajax({
        type: "POST",
        url: "/update_state_rankings",
        data: {
          'rankings[]': sortorder
        },
        success: function(data) {
          _.each(data, function(state, index) {
            return $($(".state")[index]).attr("data-ranking", index + 1);
          });
          return _.each(data, function(state, index) {
            var $state, ranking;
            $state = $($(".ranking")[index]);
            ranking = $state.parent().parent().data("ranking");
            $state.text("" + (index + 1));
            return updateRankingClasses($state, ranking);
          });
        }
      });
    }
  });
  return updateRankingClasses = function(state, ranking) {
    if (ranking < 10 && !state.hasClass("under-10")) {
      state.addClass("under-10");
    }
    if (ranking < 10 && state.hasClass("over-10")) {
      return state.removeClass("over-10");
    }
  };
});
